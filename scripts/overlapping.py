#!/usr/bin/python3
# -*- coding: utf-8 -*-
import csv
import os.path
import sys

try:
    import exrex
except ImportError:
    print("Error: Python module exrex is needed but not available.", file=sys.stderr)
    sys.exit(2)


filename = 'mapping.csv'
for path in ['./', '../']:
    if os.path.exists(os.path.join(path, filename)):
        filename = os.path.join(path, filename)
        break
else:
    print("File 'mapping.csv' not found in '.' and '..'.", file=sys.stderr)
    sys.exit(2)

with open(filename) as handle:
    mapping = csv.reader(handle)
    expressions = {line[0] for line in mapping}

known = set()
for expression in expressions:
    for ind, result in enumerate(exrex.generate(expression)):
        if result in known:
            print('Found overlap: %r.' % result)
        else:
            known.add(result)
        if ind > 100:
            print('Stop generating expressions for %r.' % expression)
            break
