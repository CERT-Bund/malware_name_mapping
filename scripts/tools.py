#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu Jun 14 11:29:14 2018

@author: sebastian
"""
import argparse
import sys

try:
    import exrex
except ImportError:
    print("Error: Python module exrex is needed but not available.", file=sys.stderr)
    sys.exit(2)


def generate(expression: str, max_matches: 100):
    for ind, result in enumerate(exrex.generate(expression)):
        if ind > max_matches:
            break
        print(result)


def main():
    parser = argparse.ArgumentParser(prog='malware name mapping tools', description='Some useful tools.')
    subparsers = parser.add_subparsers(title='tools')
    parser_start = subparsers.add_parser('generate', help='Generate matching expressions for a regular expression.')
    parser_start.add_argument('-m', '--max-matches', nargs=1, default=100)
    parser_start.add_argument('expression')
    parser_start.set_defaults(func=generate)

    args = parser.parse_args()
    if 'func' not in args:
        exit(parser.print_help())
    args_dict = vars(args).copy()
    del args_dict['func']
    return args.func(**args_dict)


if __name__ == "__main__":
    sys.exit(main())
