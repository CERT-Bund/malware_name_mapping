# -*- coding: utf-8 -*-

import csv
import os
import sys


def find_mapping(fail: bool = True) -> str:
    """
    Find the mapping.csv file in the current or parent directory.

    Parameters:
        fail: If true and the mapping cannot be found an error is printed on stderr and the program
              exits with exitcode 2.
    """
    filename = 'mapping.csv'
    for path in ['./', '../']:
        if os.path.exists(os.path.join(path, filename)):
            return os.path.join(path, filename)
    else:
        if fail is True:
            print("File 'mapping.csv' not found in '.' and '..'.", file=sys.stderr)
            sys.exit(2)


def load_mapping(filename: bool = None, fail: bool = True) -> list:
    """
    Loads the mapping from the filename and returns it as list of lists.
    Does not load the comments column(s).

    Parameters:
        filename: The filename of the mapping. find_mapping is called if not given
        fail: Passed on to find_mapping, see the docs there.

    Returns: list of lists
    """
    if not filename:
        filename = find_mapping(fail=fail)
        if not filename and not fail:
            return
    with open(filename) as handle:
        return [[column for column in line[:3]] for line in csv.reader(handle)]
